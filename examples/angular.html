<!doctype HTML>
<html>
<head>
    <meta charset="UTF-8" />
    <title>index.json jQuery example</title>
    <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.min.css" />
    <script src="bower_components/angular/angular.min.js"></script>
    <script src="../adaptors/angular.js"></script>
    <script src="../index.json.js"></script>
    <script>
    angular
        .module('example', [])
        .config(indexJsonTransport.init())
        .controller('Example', [ '$scope', '$http', function ($scope, $http) {
            $scope.credentials = {
                username: 'joe',
                password: 'password'
            };

            $scope.signIn = function () {
                $scope.error = null;

                // @todo rename to signIn
                $http.post('api/signin', $scope.credentials).then(function (response) {
                    $scope.signedIn = true;
                    $scope.userInfo = null;

                    $http.get('api/userInfo').then(function (response) {
                        $scope.userInfo = response.data;
                    });
                }, function () {
                    $scope.error = 'Authentication failed: ';
                });
            };

            $scope.signOut = function () {
                $scope.signedIn = false;
            };
        }]);
    </script>
</head>
<body ng-app="example" ng-controller="Example">
    <nav class="navbar navbar-default">
        <div class="container-fluid">
        <div class="navbar-header">
            <a class="navbar-brand" href="#">Portal</a>
        </div>
        <form id="signout" class="navbar-form navbar-right" ng-show="signedIn" ng-submit="signOut()">
            <button class="btn btn-default">Sign Out</button>
        </form>        
        <ul class="nav navbar-nav navbar-right">
            <li><a href="#" id="identity" ng-show="signedIn">{{ userInfo.firstName + ' ' + userInfo.lastName }}</a></li>
        </ul>
    </nav>
    <div class="row">
        <div class="col-xs-4 col-xs-offset-4">
            <form id="signin" class="well well-lg" ng-show="!signedIn" ng-submit="signIn()">
                <div id="error" class="alert alert-danger" ng-show="error">{{ error }}</div>
                <div class="form-group">
                    <label for="username">Username</label>
                    <input id="username" name="username" ng-model="credentials.username" class="form-control" />
                    <p class="help-block">Also try: <strong>delay</strong>, <strong>timeout</strong></p>
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input id="password" type="password" ng-model="credentials.password" class="form-control" />
                    <p class="help-block">
                        The correct password for username <strong>john</strong> is <strong>password</strong>
                    </p>
                </div>
                <button class="btn btn-primary btn-lg btn-block">Sign In</button>
            </form>
            <p id="http-status" class="text-muted" ng-show="!signedIn"></p>
            <div id="welcome" class="alert alert-success" ng-show="signedIn">
                <strong>Welcome!</strong> You have successfully signed in.
            </div>
        </div>
    </div>
</body>
</html>
